<script>
    document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);
        const symbol = urlParams.get("symbol");

        function formatNumber(num) {
            if (num >= 1e9) {
                return (num / 1e9).toFixed(2) + "B"; // Миллиарды
            } else if (num >= 1e6) {
                return (num / 1e6).toFixed(2) + "M"; // Миллионы
            } else if (num >= 1e3) {
                return (num / 1e3).toFixed(2) + "K"; // Тысячи
            }
            return num.toFixed(2); // Обычное число
        }

        if (symbol) {
            document.getElementById("crypto-title").textContent = `График ${symbol}`;
            new TradingView.widget({
                "container_id": "tradingview",
                "symbol": `BINANCE:${symbol}`,
                "interval": "30",
                "theme": "light",
                "style": "1",
                "locale": "ru",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "autosize": true
            });

            // Получение данных с Binance API
            fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("crypto-stats").innerHTML = `
                        <strong>Текущая цена:</strong> $${formatNumber(parseFloat(data.lastPrice))}<br>
                        <strong>Изменение 24ч:</strong> <span class="${data.priceChangePercent >= 0 ? 'green' : 'red'}">${data.priceChangePercent}%</span><br>
                        <strong>Объем 24ч:</strong> ${formatNumber(parseFloat(data.volume))}
                    `;
                })
                .catch(error => {
                    document.getElementById("crypto-stats").innerHTML = "Ошибка загрузки данных";
                    console.error("Ошибка загрузки данных Binance API", error);
                });
        }
    });
</script>
