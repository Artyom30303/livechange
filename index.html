<script>
    async function fetchCryptoData() {
        try {
            const response = await fetch('https://api.binance.com/api/v3/ticker/24hr');
            const data = await response.json();
            let tableHTML = '';
            data.forEach(coin => {
                if (coin.symbol.endsWith('USDT')) {
                    const priceChangeClass = parseFloat(coin.priceChangePercent) >= 0 ? 'green' : 'red';
                    tableHTML += `
                        <tr data-symbol="${coin.symbol}" class="coin-row">
                            <td>${coin.symbol.replace('USDT', '')}</td>
                            <td>$${parseFloat(coin.lastPrice).toFixed(2)}</td>
                            <td class="${priceChangeClass}">${parseFloat(coin.priceChangePercent).toFixed(2)}%</td>
                        </tr>`;
                }
            });
            document.getElementById('crypto-table').innerHTML = tableHTML;
        } catch (error) {
            console.error('Ошибка загрузки данных:', error);
        }
    }
    
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('crypto-table').addEventListener('click', function (event) {
            let row = event.target.closest('tr');
            if (!row) return;
            let symbol = row.getAttribute('data-symbol');
            if (symbol) {
                window.location.href = `coin.html?symbol=${encodeURIComponent(symbol)}`;
            }
        });
    });

    document.getElementById('search').addEventListener('input', function () {
        let filter = this.value.toUpperCase();
        let rows = document.querySelectorAll('#crypto-table tr');
        rows.forEach(row => {
            let coinName = row.cells[0].textContent.toUpperCase();
            row.style.display = coinName.includes(filter) ? '' : 'none';
        });
    });

    fetchCryptoData();
    setInterval(fetchCryptoData, 10000);
</script>
