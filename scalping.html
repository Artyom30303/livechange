<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pussy Destroyer 2.0 - AI Crypto Scalper</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script async src="https://s3.tradingview.com/tv.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        #crypto-title { font-size: 22px; font-weight: bold; margin-bottom: 10px; }
        #crypto-stats, #analysis { background: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); margin-bottom: 10px; }
        #tradingview { width: 100%; height: 500px; }
    </style>
</head>
<body>

    <h2 id="crypto-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
    <div id="crypto-stats">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
    <div id="tradingview"></div>
    <div id="analysis">–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞...</div>

    <script>
        function formatNumber(num) {
            return new Intl.NumberFormat('ru-RU', { maximumFractionDigits: 2 }).format(num);
        }

        function calculateRSI(closes, period = 14) {
            if (closes.length < period) return null;
            let gains = 0, losses = 0;
            for (let i = 1; i < period; i++) {
                let diff = closes[i] - closes[i - 1];
                if (diff >= 0) gains += diff;
                else losses -= diff;
            }
            let avgGain = gains / period;
            let avgLoss = losses / period;
            let rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        function analyzeMarket(symbol) {
            Promise.all([
                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${symbol}`).then(res => res.json()),
                fetch(`https://fapi.binance.com/fapi/v1/depth?symbol=${symbol}&limit=10`).then(res => res.json()),
                fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=5m&limit=50`).then(res => res.json())
            ]).then(([tickerData, orderBookData, klineData]) => {
                if (!tickerData || !orderBookData || !klineData) {
                    console.error("–û—à–∏–±–∫–∞: –î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.");
                    return;
                }

                const closes = klineData.map(k => parseFloat(k[4]));
                const lastPrice = parseFloat(tickerData.lastPrice);
                const changePercent = parseFloat(tickerData.priceChangePercent);
                const volume = parseFloat(tickerData.volume);
                const rsi = calculateRSI(closes);

                const maxPrice = Math.max(...closes);
                const minPrice = Math.min(...closes);
                let supportLevel = minPrice + (maxPrice - minPrice) * 0.2;
                let resistanceLevel = minPrice + (maxPrice - minPrice) * 0.8;

                const buyVolume = orderBookData.bids.reduce((acc, bid) => acc + parseFloat(bid[1]), 0);
                const sellVolume = orderBookData.asks.reduce((acc, ask) => acc + parseFloat(ask[1]), 0);
                const orderFlow = buyVolume - sellVolume;

                let signal = "‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ";
                let reasons = [];

                if (lastPrice > resistanceLevel) {
                    signal = "üöÄ –õ–æ–Ω–≥";
                    reasons.push(`–¶–µ–Ω–∞ –ø—Ä–æ–±–∏–ª–∞ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ (${formatNumber(resistanceLevel)})`);
                } else if (lastPrice < supportLevel) {
                    signal = "üìâ –®–æ—Ä—Ç";
                    reasons.push(`–¶–µ–Ω–∞ –Ω–∏–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (${formatNumber(supportLevel)})`);
                }

                if (changePercent > 2) {
                    reasons.push(`–†–æ—Å—Ç —Ü–µ–Ω—ã ${formatNumber(changePercent)}% –∑–∞ 24—á.`);
                } else if (changePercent < -2) {
                    reasons.push(`–ü–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã ${formatNumber(changePercent)}% –∑–∞ 24—á.`);
                }

                if (rsi !== null) {
                    if (rsi > 55) {
                        reasons.push(`RSI = ${formatNumber(rsi)} (–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å).`);
                    } else if (rsi < 45) {
                        reasons.push(`RSI = ${formatNumber(rsi)} (–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å).`);
                    }
                }

                if (orderFlow > 0) {
                    reasons.push(`–ë–æ–ª—å—à–µ —Å–ø—Ä–æ—Å–∞ –≤ —Å—Ç–∞–∫–∞–Ω–µ (–ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ –∞–∫—Ç–∏–≤–Ω–µ–µ).`);
                } else {
                    reasons.push(`–ë–æ–ª—å—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ —Å—Ç–∞–∫–∞–Ω–µ (–ø—Ä–æ–¥–∞–≤—Ü—ã –¥–æ–º–∏–Ω–∏—Ä—É—é—Ç).`);
                }

                document.getElementById("crypto-stats").innerHTML = `
                    <strong>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:</strong> $${formatNumber(lastPrice)}<br>
                    <strong>–ò–∑–º–µ–Ω–µ–Ω–∏–µ 24—á:</strong>
                    <span class="${changePercent >= 0 ? 'green' : 'red'}">${formatNumber(changePercent)}%</span><br>
                    <strong>–û–±—ä–µ–º 24—á:</strong> ${formatNumber(volume)}
                `;

                document.getElementById("analysis").innerHTML = `
                    <strong>–°–∏–≥–Ω–∞–ª:</strong> ${signal}<br>
                    <ul>${reasons.map(r => `<li>${r}</li>`).join('')}</ul>
                `;
            }).catch(err => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", err));
        }

        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(() => {
                const titleElement = document.getElementById("crypto-title");
                if (!titleElement) {
                    console.error("–û—à–∏–±–∫–∞: #crypto-title –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM!");
                    return;
                }

                const urlParams = new URLSearchParams(window.location.search);
                let symbol = urlParams.get("symbol") || "BTCUSDT";
                titleElement.textContent = `–°–∫–∞–ª—å–ø–∏–Ω–≥: ${symbol}`;

                new TradingView.widget({
                    container_id: "tradingview",
                    symbol: `BINANCE:${symbol}`,
                    interval: "5",
                    theme: "light",
                    style: "1",
                    locale: "ru",
                    toolbar_bg: "#f1f3f6",
                    enable_publishing: false,
                    hide_side_toolbar: false,
                    allow_symbol_change: true,
                    autosize: true
                });

                analyzeMarket(symbol);
            }, 500);
        });
    </script>

</body>
</html>
