<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pussy Destroyer 2.0 - AI Crypto Scalper</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script async src="https://s3.tradingview.com/tv.js"></script> <!-- Загружаем TradingView отдельно -->
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        #crypto-title, #crypto-stats { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        #tradingview { width: 100%; height: 500px; }
    </style>
</head>
<body>
    <h2 id="crypto-title">Загрузка...</h2>
    <div id="crypto-stats">Загрузка данных...</div>
    <div id="tradingview"></div>

    <script>
        function formatNumber(num) {
            return new Intl.NumberFormat('ru-RU', { maximumFractionDigits: 2 }).format(num);
        }

        function initTradingView(symbol) {
            if (typeof TradingView === "undefined") {
                console.error("TradingView API не загрузился!");
                return;
            }
            new TradingView.widget({
                container_id: "tradingview",
                symbol: `BINANCE:${symbol}`,
                interval: "5",
                theme: "light",
                style: "1",
                locale: "ru",
                toolbar_bg: "#f1f3f6",
                enable_publishing: false,
                hide_side_toolbar: false,
                allow_symbol_change: true,
                autosize: true
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(() => {
                const titleElement = document.getElementById("crypto-title");
                const statsElement = document.getElementById("crypto-stats");

                if (!titleElement || !statsElement) {
                    console.error("КРИТИЧЕСКАЯ ОШИБКА: Элементы #crypto-title или #crypto-stats не найдены в DOM!");
                    return;
                }

                const urlParams = new URLSearchParams(window.location.search);
                let symbol = urlParams.get("symbol") || "BTCUSDT";
                titleElement.textContent = `Скальпинг: ${symbol}`;

                fetch(`https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=${symbol}`)
                    .then(res => res.json())
                    .then(data => {
                        statsElement.innerHTML = `
                            <strong>Текущая цена:</strong> $${formatNumber(data.lastPrice)}<br>
                            <strong>Изменение 24ч:</strong>
                            <span class="${data.priceChangePercent >= 0 ? 'green' : 'red'}">
                                ${formatNumber(data.priceChangePercent)}%
                            </span><br>
                            <strong>Объем 24ч:</strong> ${formatNumber(data.volume)}
                        `;
                    })
                    .catch(err => console.error("Ошибка загрузки данных Binance:", err));

                // Ждём загрузки TradingView
                let checkTradingView = setInterval(() => {
                    if (typeof TradingView !== "undefined") {
                        clearInterval(checkTradingView);
                        initTradingView(symbol);
                    }
                }, 500);
            }, 500);
        });
    </script>
</body>
</html>
